

### 4.1 业务逻辑层的分解

#### hotelbl模块

##### 模块的设计，如图

![](https://supernatural.oss-cn-beijing.aliyuncs.com/ljy详细设计4.1业务逻辑层的分解_hotelbl模块设计图.png)

##### 各个类的职责

| 模块            | 职责                                                         |
| --------------- | ------------------------------------------------------------ |
| HotelController | 负责实现酒店列表、酒店详情、酒店评价的功能                   |
| TagController   | 负责实现酒店设施服务标签的功能                               |
| CommentService  | 负责实现评论相关业务逻辑                                     |
| HotelService    | 负责实现酒店相关业务逻辑                                     |
| RoomService     | 负责实现酒店房间的业务逻辑                                   |
| TagService      | 负责实现酒店设施服务标签的业务逻辑                           |
| Comment         | 酒店评论的领域模型对象，拥有评论内容、回复内容等信息，用于存放交给数据库的评论数据 |
| CommentVO       | 酒店评论的领域模型对象，拥有评论内容、回复内容等信息，用于存放交给前端的评论数据 |
| Hotel           | 酒店的领域模型对象，拥有名称、地址、星级等基本信息，用于存放交给数据库的酒店信息数据 |
| HotelVO         | 酒店的领域模型对象，拥有名称、地址、星级等基本信息，用于存放交给前端的酒店信息数据 |
| HotelRoom       | 酒店房间的领域模型对象，用于存放交给数据库的房间信息数据     |
| RoomVO          | 酒店房间的领域模型对象，用于存放交给前端的房间信息数据       |
| Order           | 预订订单的领域模型对象，用于查看某用户是否预订过一家酒店     |
| MyTag           | 酒店设施服务的领域模型对象，拥有一项设施服务标签的名称、所属酒店等信息 |

##### 模块内部类的接口规范


###### CommentServiceImpl

<table>
    <tr>
    	<td colspan="3"><center>提供的服务（供接口）</center></td>
    </tr>
    <tr>
        <td rowspan="3"><center>CommentServiceImpl.addComment</center></td>
        <td>语法</td>
        <td>public ResponseVO addComment(CommentVO commentVO);</td>
    </tr>
    <tr>
        <td>前置条件</td>
        <td>需要添加一条评论</td>
    </tr>
    <tr>
        <td>后置条件</td>
        <td>添加一条评论</td>
    </tr>
    <tr>
        <td rowspan="3"><center>CommentServiceImpl.getCommentByHotelId</center></td>
        <td>语法</td>
        <td>public List<Comment> getCommentByHotelId(Integer hotelId);</td>
    </tr>
    <tr>
        <td>前置条件</td>
        <td>需要获取酒店的全部评论</td>
    </tr>
    <tr>
        <td>后置条件</td>
        <td>获取酒店的评论列表</td>
    </tr>
    <tr>
        <td rowspan="3"><center>CommentServiceImpl.updateReply</center></td>
        <td>语法</td>
        <td>public ResponseVO updateReply(int commentId,String reply);</td>
    </tr>
    <tr>
        <td>前置条件</td>
        <td>需要更新回复</td>
    </tr>
    <tr>
        <td>后置条件</td>
        <td>更新回复</td>
    </tr>
    <tr>
        <td colspan="3"><center>需要的服务（需接口）</center></td>
    </tr>
    <tr>
        <td><center>服务名</center></td>
        <td colspan="2"><center>服务</center></td>
    </tr>
    <tr>
        <td>CommentMapper.addComment(Comment comment)</center></td>
        <td colspan="2">增加评论</center></td>
    </tr>
    <tr>
        <td>CommentMapper.getCommentByHotelId(int hotelId)</center></td>
        <td colspan="2">获取酒店评论</center></td>
    </tr>
    <tr>
        <td>CommentMapper.updateReply(int commentId,String reply)</center></td>
        <td colspan="2">更新评论</center></td>
    </tr>
    <tr>
        <td>ResponseVO.buildFailure(String message)</td>
        <td colspan="2">返回构建失败的信息</td>
    </tr>
    <tr>
        <td>ResponseVO.buildSuccess(Object content)</td>
        <td colspan="2">返回构建成功的信息</td>
    </tr>
</table>    



###### TagServiceImpl

<table>
    <tr>
    	<td colspan="3"><center>提供的服务（供接口）</center></td>
    </tr>
    <tr>
    	<td rowspan="3"><center>TagServiceImpl.getTagsByHotelId</center></td>
   		<td>语法</td>
        <td>public List<MyTag> getTagsByHotelId(Integer hotelId);</td>
    </tr>
    <tr>
        <td>前置条件</td>
        <td>需要获取酒店服务标签</td>
    </tr>
    <tr>
        <td>后置条件</td>
        <td>获取酒店服务标签</td>
    </tr>
    <tr>
    	<td rowspan="3"><center>TagServiceImpl.save</center></td>
   		<td>语法</td>
        <td>public ResponseVO save(String tagName,Integer hotelId);</td>
    </tr>
    <tr>
        <td>前置条件</td>
        <td>需要添加酒店服务标签</td>
    </tr>
    <tr>
        <td>后置条件</td>
        <td>添加酒店服务标签</td>
    </tr>
    <tr>
    	<td rowspan="3"><center>TagServiceImpl.deleteById</center></td>
   		<td>语法</td>
        <td>public ResponseVO deleteById(Integer id);</td>
    </tr>
    <tr>
        <td>前置条件</td>
        <td>需要删除酒店服务标签</td>
    </tr>
    <tr>
        <td>后置条件</td>
        <td>删除酒店服务标签</td>
    </tr>
    <tr>
    	<td colspan="3"><center>需要的服务（需接口）</center></td>
    </tr>
    <tr>
    	<td><center>服务名</center></td>
        <td colspan="2"><center>服务</center></td>
    </tr>
    <tr>
    	<td>MyTagMapper.getTagsByHotelId(int hotelId);</center></td>
        <td colspan="2">获取酒店全部标签</center></td>
    </tr>
    <tr>
    	<td>MyTagMapper.deleteById(int id)</center></td>
        <td colspan="2">删除标签</center></td>
    </tr>
    <tr>
    	<td>MyTagMapper.selectByHotelIdAndTagName(String tagName,int hotelId)</center></td>
        <td colspan="2">根据标签名与酒店编号获取标签列表</center></td>
    </tr>
    <tr>
    	<td>MyTagMapper.insert(Tag tag)</center></td>
        <td colspan="2">向数据库添加标签</center></td>
    </tr>
    <tr>
    	<td>MyTag.setHotelId(int id)</td>
        <td colspan="2">设置标签所属标签</center></td>
    </tr>
    <tr>
    	<td>MyTag.setTagName(String tagName)</td>
        <td colspan="2">设置标签名称</center></td>
    </tr>
    <tr>
        <td>ResponseVO.buildFailure(String message)</td>
        <td colspan="2">返回构建失败的信息</td>
    </tr>
    <tr>
        <td>ResponseVO.buildSuccess(Object content)</td>
        <td colspan="2">返回构建成功的信息</td>
    </tr>
</table>

###### RoomServiceImpl

<table>
    <tr>
        <td colspan="3"><center>提供的服务（供接口）</center></td>
    </tr>
    <tr>
        <td rowspan="3"><center>RoomServiceImpl.retrieveHotelRoomInfo</center></td>
        <td>语法</td>
        <td>List<HotelRoom> retrieveHotelRoomInfo(Integer hotelId);</td>
    </tr>
    <tr>
        <td>前置条件</td>
        <td>需要获取某个酒店的全部房间信息</td>
    </tr>
    <tr>
        <td>后置条件</td>
        <td>返回某个酒店的全部房间信息的列表</td>
    </tr>
    <tr>
        <td rowspan="3"><center>RoomServiceImpl.insertRoomInfo</center></td>
        <td>语法</td>
        <td>void insertRoomInfo(HotelRoom hotelRoom);</td>
    </tr>
    <tr>
        <td>前置条件</td>
        <td>需要添加酒店客房信息</td>
    </tr>
    <tr>
        <td>后置条件</td>
        <td>添加酒店客房信息</td>
    </tr>
    <tr>
        <td rowspan="3"><center>RoomServiceImpl.updateRoomInfo</center></td>
        <td>语法</td>
        <td>void updateRoomInfo(Integer hotelId, String roomType, Integer rooms);</td>
    </tr>
    <tr>
        <td>前置条件</td>
        <td>预订酒店后，需要更新客房房间数量</td>
    </tr>
    <tr>
        <td>后置条件</td>
        <td>更新客房房间数量</td>
    </tr>
    <tr>
        <td rowspan="3"><center>RoomServiceImpl.getRoomCurNum</center></td>
        <td>语法</td>
        <td>int getRoomCurNum(Integer hotelId, String roomType);</td>
    </tr>
    <tr>
        <td>前置条件</td>
        <td>需要获取酒店指定房间剩余数量</td>
    </tr>
    <tr>
        <td>后置条件</td>
        <td>返回酒店指定房间剩余数量</td>
    </tr>
    <tr>
        <td colspan="3"><center>需要的服务（需接口）</center></td>
    </tr>
    <tr>
        <td><center>服务名</center></td>
        <td colspan="2"><center>服务</center></td>
    </tr>
    <tr>
        <td>RoomMapper.selectRoomsByHotelId(@Param("hotelId") Integer hotelId)</td>
        <td colspan="2">返回指定id的酒店的全部房间信息列表</td>
    </tr>
    <tr>
        <td>RoomMapper.insertRoom(HotelRoom hotelRoom)</td>
        <td colspan="2">在数据库中插入房间</td>
    </tr>
    <tr>
        <td>RoomMapper.updateRoomInfo(@Param("hotelId") Integer hotelId,@Param("roomType") String roomType,@Param("curNum") Integer curNum)</td>
        <td colspan="2">在数据库中更新房间信息</td>
    </tr>
    <tr>
        <td>RoomMapper.getRoomCurNum(@Param("hotelId") Integer hotelId,@Param("roomType") String roomType)</td>
        <td colspan="2">返回指定酒店的指定类型房间的当前数量</td>
    </tr>
    <tr>
        <td>ResponseVO.buildFailure(String message)</td>
        <td colspan="2">返回构建失败的信息</td>
    </tr>
    <tr>
        <td>ResponseVO.buildSuccess(Object content)</td>
        <td colspan="2">返回构建成功的信息</td>
    </tr>
</table>

###### HotelServiceImpl


<table>
    <tr>
        <td colspan="3"><center>提供的服务（供接口）</center></td>
    </tr>
    <tr>
        <td rowspan="3"><center>HotelServiceImpl.addHotel</center></td>
        <td>语法</td>
        <td>public void addHotel(HotelVO hotelVO) throws ServiceException;</td>
    </tr>
    <tr>
        <td>前置条件</td>
        <td>需要添加一个酒店</td>
    </tr>
    <tr>
        <td>后置条件</td>
        <td>添加一个酒店</td>
    </tr>
    <tr>
        <td rowspan="3"><center>HotelServiceImpl.updateRoomInfo</center></td>
        <td>语法</td>
        <td>public void updateRoomInfo(Integer hotelId, String roomType, Integer rooms);</td>
    </tr>
    <tr>
        <td>前置条件</td>
        <td>预订完成，需要更新酒店房间的信息</td>
    </tr>
    <tr>
        <td>后置条件</td>
        <td>更新酒店房间的信息</td>
    </tr>
    <tr>
        <td rowspan="3"><center>HotelServiceImpl.getRoomCurNum</center></td>
        <td>语法</td>
        <td>public int getRoomCurNum(Integer hotelId, String roomType);</td>
    </tr>
    <tr>
        <td>前置条件</td>
        <td>需要得到酒店目前某类型房间的数量</td>
    </tr>
    <tr>
        <td>后置条件</td>
        <td>返回房间数量</td>
    </tr>
    <tr>
        <td rowspan="3"><center>HotelServiceImpl.retrieveHotels</center></td>
        <td>语法</td>
        <td>public List<HotelVO> retrieveHotels(Integer userid);</td>
    </tr>
    <tr>
        <td>前置条件</td>
        <td>需要获取某用户预订过的酒店信息</td>
    </tr>
    <tr>
        <td>后置条件</td>
        <td>返回预订过酒店信息列表</td>
    </tr>
    <tr>
        <td rowspan="3"><center>HotelServiceImpl.getAllHotels</center></td>
        <td>语法</td>
        <td>public List<HotelVO> getAllHotels();</td>
    </tr>
    <tr>
        <td>前置条件</td>
        <td>需要获取酒店信息</td>
    </tr>
    <tr>
        <td>后置条件</td>
        <td>返回酒店信息列表</td>
    </tr>
    <tr>
        <td rowspan="3"><center>HotelServiceImpl.retrieveHotelDetails</center></td>
        <td>语法</td>
        <td>public HotelVO retrieveHotelDetails(Integer hotelId,Integer userid);</td>
    </tr>
    <tr>
        <td>前置条件</td>
        <td>需要获取某用户预订过的某家酒店详细信息</td>
    </tr>
    <tr>
        <td>后置条件</td>
        <td>返回某家酒店详细信息</td>
    </tr>
    <tr>
        <td rowspan="3"><center>HotelServiceImpl.getHotelInfo</center></td>
        <td>语法</td>
        <td>public HotelVO retrieveHotelDetails(Integer hotelId);</td>
    </tr>
    <tr>
        <td>前置条件</td>
        <td>需要获取某家酒店详细信息</td>
    </tr>
    <tr>
        <td>后置条件</td>
        <td>返回某家酒店详细信息</td>
    </tr>
    <tr>
    	<td rowspan="3"><center>HotelServiceImpl.retrieveHotelByDate</center></td>
        <td>语法</td>
        <td>public List<HotelVO> retrieveHotelByDate(Integer userid, String checkInDate, String checkOutDate);</td>
    </tr>
    <tr>
    	<td>前置条件</td>
        <td>需要按照日期检索酒店</td>
    </tr>
    <tr>
    	<td>后置条件</td>
        <td>返回按照日期检索酒店结果列表</td>
    </tr>
    <tr>
    	<td rowspan="3"><center>HotelServiceImpl.updateHotelInfo</center></td>
        <td>语法</td>
        <td>public ResponseVO updateHotelInfo(int id, String address, String phoneNum);</td>
    </tr>
    <tr>
    	<td>前置条件</td>
        <td>需要更新酒店信息</td>
    </tr>
    <tr>
    	<td>后置条件</td>
        <td>返回更新酒店信息结果</td>
    </tr>
    <tr>
        <td colspan="3"><center>需要的服务（需接口）</center></td>
    </tr>
    <tr>
        <td><center>服务名</center></td>
        <td colspan="2"><center>服务</center></td>
    </tr>
    <tr>
    	<td>OrderService.hasOrderedBefore(int id)</td>
        <td colspan="2">获取客户是否预订过的信息</td>
    </tr>
    <tr>
    	<td>CouponService.getHotelAllCouponName(int id)</td>
        <td colspan="2">获取某酒店的全部优惠券</td>
    </tr>
    <tr>
        <td>AccountService.getUserInfo(int id)</td>
        <td colspan="2">获取用户个人信息</td>
    </tr>
    <tr>
        <td>User.getUserType()</td>
        <td colspan="2">返回用户类型</td>
    </tr>
    <tr>
        <td>HotelMapper.insertHotel(Hotel hotel)</td>
        <td colspan="2">在数据库中插入酒店</td>
    </tr>
    <tr>
        <td>RoomService.updateRoomInfo(Integer hotelId, String roomType, Integer rooms)</td>
        <td colspan="2">预订酒店后更新客房房间数量</td>
    </tr>
    <tr>
        <td>RoomService.getRoomCurNum(Integer hotelId, String roomType)</td>
        <td colspan="2">获取酒店指定房间剩余数量</td>
    </tr>
    <tr>
        <td>HotelMapper.selectAllHotel()</td>
        <td colspan="2">返回所有酒店列表</td>
    </tr>
    <tr>
        <td>HotelMapper.selectById(Integer hotelId)</td>
        <td colspan="2">根据id返回酒店对象</td>
    </tr>
    <tr>
        <td>RoomService.retrieveHotelRoomInfo(hotelId)</td>
        <td colspan="2">获取某个酒店的全部房间信息</td>
    </tr>
    <tr>
        <td>RoomVO.setId(Integer id)</td>
        <td colspan="2">设置房间id</td>
    </tr>
    <tr>
        <td>RoomVO.setPrice(Double price)</td>
        <td colspan="2">返回房间价格</td>
    </tr>
    <tr>
        <td>RoomVO.setRoomType(String roomType)</td>
        <td colspan="2">返回房间类型</td>
    </tr>
    <tr>
        <td>RoomVO.setCurNum(Integer curNum)</td>
        <td colspan="2">设置当前房间数量</td>
    </tr>
    <tr>
        <td>RoomVO.setTotal(Integer total)</td>
        <td colspan="2">设置房间总数</td>
    </tr>
    <tr>
        <td>Hotel.setAddress(String address)</td>
        <td colspan="2">设置酒店地址</td>
    </tr>
    <tr>
        <td>Hotel.setBizRegion(BizRegion bizRegion)</td>
        <td colspan="2">设置酒店商圈</td>
    </tr>
    <tr>
        <td>Hotel.setRate(Double rate)</td>
        <td colspan="2">设置酒店评分</td>
    </tr>
    <tr>
        <td>Hotel.setManagerId(Integer managerId)</td>
        <td colspan="2">设置酒店经理</td>
    </tr>
    <tr>
        <td>Hotel.setPhoneNum(String phoneNum)</td>
        <td colspan="2">设置酒店电话</td>
    </tr>
    <tr>
        <td>Hotel.setHotelName(String hotelName)</td>
        <td colspan="2">设置酒店名称</td>
    </tr>
    <tr>
        <td>Hotel.setHotelStar(HotelStar hotelStar)</td>
        <td colspan="2">设置酒店星级</td>
    </tr>
    <tr>
        <td>HotelVO.setRooms(List<RoomVO> rooms)</td>
        <td colspan="2">设置酒店房间</td>
    </tr>
    <tr>
        <td>Hotel.setDescription(String description)</td>
        <td colspan="2">设置酒店描述</td>
    </tr>



#### adminbl模块

##### 各个类的职责

| 模块            | 职责                                                         |
| --------------- | ------------------------------------------------------------ |
| AdminController | 负责实现网站管理员所提供的功能                               |
| AdminService    | 负责实现网站管理员的业务逻辑                                 |
| User            | 系统用户的领域模型对象，拥有用户数据的邮箱、用户名、密码等信息 |

##### 模块内部类的接口规范

###### AdminServiceImpl

<table>
    <tr>
        <td colspan="3"><center>提供的服务（供接口）</center></td>
    </tr>
    <tr>
        <td rowspan="3"><center>AdminServiceImpl.addManager</center></td>
        <td>语法</td>
        <td>public ResponseVO addManager(HotelManagerVO vo);</td>
    </tr>
    <tr>
        <td>前置条件</td>
        <td>需要添加一个酒店经理</td>
    </tr>
    <tr>
        <td>后置条件</td>
        <td>添加一个酒店经理</td>
    </tr>
    <tr>
        <td rowspan="3"><center>AdminServiceImpl.addOperator</center></td>
        <td>语法</td>
        <td>public ResponseVO addOperator(UserForm userForm);</td>
    </tr>
    <tr>
        <td>前置条件</td>
        <td>需要添加一个运营人员</td>
    </tr>
    <tr>
        <td>后置条件</td>
        <td>添加一个运营人员</td>
    </tr>
    <tr>
        <td rowspan="3"><center>AdminServiceImpl.getAllManagers</center></td>
        <td>语法</td>
        <td>public List<User> getAllManagers();</td>
    </tr>
    <tr>
        <td>前置条件</td>
        <td>需要得到所有经理的信息</td>
    </tr>
    <tr>
        <td>后置条件</td>
        <td>返回所有经理信息的列表</td>
    </tr>
    <tr>
        <td rowspan="3"><center>AdminServiceImpl.getAllClients</center></td>
        <td>语法</td>
        <td>public List<User> getAllClients();</td>
    </tr>
    <tr>
        <td>前置条件</td>
        <td>需要得到所有客户的信息</td>
    </tr>
    <tr>
        <td>后置条件</td>
        <td>返回所有客户的列表</td>
    </tr>
    <tr>
        <td rowspan="3"><center>AdminServiceImpl.getAllOperators</center></td>
        <td>语法</td>
        <td>public List<User> getAllOperators();</td>
    </tr>
    <tr>
        <td>前置条件</td>
        <td>需要得到所有运营人员的信息</td>
    </tr>
    <tr>
        <td>后置条件</td>
        <td>返回所有运营人员的列表</td>
    </tr>
    <tr>
        <td rowspan="3"><center>AdminServiceImpl.deleteHM</center></td>
        <td>语法</td>
        <td>public ResponseVO deleteHM(Integer hotelId);</td>
    </tr>
    <tr>
        <td>前置条件</td>
        <td>需要删除酒店及工作人员</td>
    </tr>
    <tr>
        <td>后置条件</td>
        <td>删除酒店及工作人员</td>
    </tr>
    <tr>
        <td rowspan="3"><center>AdminServiceImpl.getCurveDataSet</center></td>
        <td>语法</td>
        <td>public AdminCurveVO getCurveDataSet();</td>
    </tr>
    <tr>
        <td>前置条件</td>
        <td>需要绘制推广度曲线</td>
    </tr>
    <tr>
        <td>后置条件</td>
        <td>获得推广度曲线所需的datasets</td>
    </tr>
    <tr>
        <td colspan="3"><center>需要的服务（需接口）</center></td>
    </tr>
    <tr>
        <td><center>服务名</center></td>
        <td colspan="2"><center>服务</center></td>
    </tr>
    <tr>
        <td>User.setEmail(String email)</td>
        <td colspan="2">设置用户的email</td>
    </tr>
    <tr>
        <td>User.setPassword(String pwd)</td>
        <td colspan="2">设置用户密码</td>
    </tr>
    <tr>
        <td>User.setUserType(UserType usertype)</td>
        <td colspan="2">设置用户类型</td>
    </tr>
    <tr>
        <td>User.setUserName(String userName)</td>
        <td colspan="2">设置用户名</td>
    </tr>
     <tr>
    	<td>User.getCreateTime()</td>
        <td colspan="2">获取用户创建时间</td>  
    </tr>
    <tr>
        <td>AdminMapper.addManager(User user)</td>
        <td colspan="2">在sql数据库中添加经理</td>
    </tr>
    <tr>
        <td>AdminMapper.addOperator(User user)</td>
        <td colspan="2">在sql数据库中添加运营人员</td>
    </tr>
    <tr>
        <td>AdminMapper.getAllManagers()</td>
        <td colspan="2">获取全部经理</td>
    </tr>
    <tr>
        <td>AdminMapper.getAllClients()</td>
        <td colspan="2">获取全部客户</td>
    </tr>
    <tr>
        <td>AdminMapper.getAllOperators()</td>
        <td colspan="2">获取全部运营人员</td>
    </tr>
    <tr>
    	<td>AccountMapper.deleteUser(Integer userId)</td>
        <td colspan="2">删除用户</td>
    </tr>
    <tr>
    	<td>HotelMapper.selectById(Integer hotelId)</td>
        <td colspan="2">获取酒店</td>
    </tr>
    <tr>
    	<td>HotelMapper.delete(Integer hotelId)</td>
        <td colspan="2">删除酒店</td>
    </tr>
    <tr>
        <td>ResponseVO.buildFailure(String message)</td>
        <td colspan="2">返回构建失败的信息</td>
    </tr>
    <tr>
        <td>ResponseVO.buildSuccess(Object content)</td>
        <td colspan="2">返回构建成功的信息</td>
    </tr>
</table>

